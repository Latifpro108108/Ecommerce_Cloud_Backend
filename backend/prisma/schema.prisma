// GoMart E-commerce Platform - Prisma Schema
// MongoDB Database Configuration for Ghana-focused ecommerce platform

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// Customer Entity - User management with Ghana-specific fields
model Customer {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  firstName   String
  lastName    String
  email       String   @unique
  phoneNumber String   @unique
  password    String
  region      String   // Ghana regions: Greater Accra, Ashanti, etc.
  city        String
  address     String
  dateJoined  DateTime @default(now())
  isActive    Boolean  @default(true)
  
  // Relationships
  orders      Order[]
  reviews     Review[]
  cart        Cart?
  
  @@map("customers")
}

// Category Entity - Product categorization
model Category {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  categoryName String   @unique
  description String?
  
  // Relationships
  products    Product[]
  
  @@map("categories")
}

// Vendor Entity - Seller management
model Vendor {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  vendorName      String
  email           String   @unique
  phoneNumber     String
  businessAddress String
  region          String   // Ghana regions
  city            String
  joinedDate      DateTime @default(now())
  isVerified      Boolean  @default(false)
  
  // Relationships
  products        Product[]
  
  @@map("vendors")
}

// Product Entity - Main product catalog
model Product {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  productName  String
  description  String
  price        Float    // Stored in Ghana Cedi (GHS)
  stockQuantity Int
  imageURL     String?
  createdAt    DateTime @default(now())
  
  // Foreign Keys
  categoryId   String   @db.ObjectId
  vendorId     String   @db.ObjectId
  
  // Relationships
  category     Category    @relation(fields: [categoryId], references: [id])
  vendor       Vendor      @relation(fields: [vendorId], references: [id])
  orderItems   OrderItem[]
  reviews      Review[]
  cartItems    CartItem[]
  
  @@map("products")
}

// Courier Entity - Delivery service providers
model Courier {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  courierName String
  phoneNumber String
  email       String?
  region      String   // Service area in Ghana
  isActive    Boolean  @default(true)
  
  // Relationships
  shipments   Shipping[]
  
  @@map("couriers")
}

// Order Entity - Customer orders
model Order {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  orderDate   DateTime @default(now())
  status      String   @default("pending") // pending, confirmed, shipped, delivered, cancelled
  totalAmount Float    // In Ghana Cedi (GHS)
  
  // Foreign Keys
  customerId  String   @db.ObjectId
  paymentId   String?  @db.ObjectId
  shippingId  String?  @db.ObjectId
  
  // Relationships
  customer    Customer   @relation(fields: [customerId], references: [id])
  payment     Payment?   @relation(fields: [paymentId], references: [id])
  shipping    Shipping?  @relation(fields: [shippingId], references: [id])
  orderItems  OrderItem[]
  
  @@map("orders")
}

// OrderItem Entity - Individual items in an order
model OrderItem {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  quantity  Int
  unitPrice Float  // Price at time of order in GHS
  subtotal  Float  // quantity * unitPrice
  
  // Foreign Keys
  orderId   String @db.ObjectId
  productId String @db.ObjectId
  
  // Relationships
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
  
  @@map("orderItems")
}

// Payment Entity - Payment processing with Mobile Money support
model Payment {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  paymentDate          DateTime @default(now())
  amount               Float    // In Ghana Cedi (GHS)
  paymentMethod        String   // MTN Mobile Money, Vodafone Cash, AirtelTigo Money, Bank Transfer, Cash
  transactionReference String?  // Mobile Money transaction ID
  status               String   @default("pending") // pending, completed, failed, refunded
  
  // Foreign Keys
  orderId              String   @unique @db.ObjectId
  
  // Relationships
  order                Order[]
  
  @@map("payments")
}

// Shipping Entity - Order delivery management
model Shipping {
  id              String    @id @default(auto()) @map("_id") @db.ObjectId
  shippingAddress String
  city            String
  region          String    // Ghana region
  postalCode      String?   // Ghana postal codes
  shippingDate    DateTime?
  deliveryDate    DateTime?
  status          String    @default("pending") // pending, shipped, in_transit, delivered, failed
  
  // Foreign Keys
  orderId         String    @unique @db.ObjectId
  courierId       String    @db.ObjectId
  
  // Relationships
  order           Order[]
  courier         Courier   @relation(fields: [courierId], references: [id])
  
  @@map("shipping")
}

// Review Entity - Product reviews and ratings
model Review {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  rating     Int      // 1-5 star rating
  comment    String?
  createdAt  DateTime @default(now())
  
  // Foreign Keys
  customerId String   @db.ObjectId
  productId  String   @db.ObjectId
  
  // Relationships
  customer   Customer @relation(fields: [customerId], references: [id])
  product    Product  @relation(fields: [productId], references: [id])
  
  @@map("reviews")
}

// Cart Entity - Shopping cart management
model Cart {
  id         String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt  DateTime   @default(now())
  
  // Foreign Keys
  customerId String     @unique @db.ObjectId
  
  // Relationships
  customer   Customer   @relation(fields: [customerId], references: [id])
  cartItems  CartItem[]
  
  @@map("carts")
}

// CartItem Entity - Items in shopping cart
model CartItem {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  quantity  Int
  
  // Foreign Keys
  cartId    String @db.ObjectId
  productId String @db.ObjectId
  
  // Relationships
  cart      Cart    @relation(fields: [cartId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
  
  @@map("cartItems")
}
